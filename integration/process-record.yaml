# camel-k: language=yaml
- from:
    uri: "knative:channel/record-queued"
    steps:
      - log:
          message: "Received Body ${body}"
      - unmarshal:
          json: {}
      - choice:
          otherwise:
            steps:
              - remove-headers: "*"
              - marshal:
                  json: {}
              - set-header:
                  constant: others
                  name: ce-type
              - to: 'log:high?showAll=true&multiline=true'
              - to: 'knative:event/record-processed'
          when:
            - simple: "$[*].nationality == 'singapore'"
              steps:
                - remove-headers: "*"
                - marshal:
                    json: {}
                - set-header:
                    constant: singaporean
                    name: ce-type
                - to: "log:info?showAll=true&multiline=true"
                - to: "knative:event/record-processed"

